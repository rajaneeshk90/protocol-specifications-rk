# How to build the specification

The full specification can be found at `api/network-observability/build/network-observability.yaml`

This is an autogenerated file created by compiling two sets of components namely,

1. APIs : found at `api/network-observability/components/io`
2. Schema : found at `api/network-observability/components/schemas`

The compilation flow is illustrated below


# Compilation steps

## Step 1 : Create the schema index file

- Go to the ```api/network-observability/components/schemas/``` folder
- Create a file ```index.yaml```. If already present, open it in a text editor
- It will contain a list of schema with $refs pointing to specific schema files in the current folder as shown below

```
Context:
  $ref: "../../../../schema/Context.yaml"

Ack:
  $ref: "../../../../schema/Ack.yaml"

Error:
  $ref: "../../../../schema/Error.yaml"
...
```
- Ensure that each file in the ```schemas``` folder has an entry in this file. If it is not present, it will not be compiled


## Step 2 : Create the unresolved OpenAPI file

- Go to the `api/network-observability/components/` folder
- In this folder, create a file - `index.yaml`. If it is already present, open it in a text editor.
- In the file, you will see the following

```
openapi: 3.1.0
info:
  title: Beckn Protocol Specification Network Observability APIs

...

```
- As you can see, the ```index.yaml``` contains the unresolved Open API definitions with references to the APIs found in ```api/network-observability/components/io/```
- Ensure each API definition in the ```api/network-observability/components/io/``` folder is referenced in this file. If it is not present, it will not be compiled. 
- Once all API referencing is done, save this file and close it.

## Install swagger CLI

- Install the swagger command line tool using ```npm```
- Note: you may need to use root privileges if installing it globally

```
sudo npm install -g swagger-cli
```

## Generate the resolved OpenAPI definition file

- Go to the root directory of this project i.e ```protocol-specifications/```
- Run the following command

```
swagger-cli bundle api/network-observability/components/index.yaml --outfile api/network-observability/build/network-observability.yaml --type yaml
```

- If the command runs successfully, you should see an output like this,

```
Created api/network-observability/build/network-observability.yaml from api/network-observability/components/index.yaml
```

- Commit the changes and push the updated code